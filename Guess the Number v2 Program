import random

# Variable for ending the game
endGame = False

# List to help rearrange the leaderboard
lbInfo = []

# Creating a file called leaderboard.txt
f = open("leaderboard.txt", "a")

# Setting up user class to keep the user's score and name
class User():

    def __init__ (self, name, score):

        self.name = name
        self.score = score

    def assignScore(self, score):

        self.score = score

    def addList(self):

        userInfo = (self.name, self.score)

        lbInfo.append(userInfo)
        
        #print(f"Username: (self.name)")
        #print(f"Score: (self.score)")



# Main gameplay
def game():

    nameInput = input("\nEnter your username: ")
    user1 = User(nameInput, 0)
    
    number = random.randint(1, 100)

    user1.assignScore(1000)
    

    print("\nThe number is between 1 and 100.")

    while True:

        while True:
            guess_input = input("\nEnter a guess: ")

            if guess_input.isdigit(): 

                guess = int(guess_input)

                if guess > 100 or guess < 1:

                    print("\nEnter a number within the specified range (1-100).")

                else:

                    break

            else:

                print("\nEnter a valid number between 1 and 100.")
            
            
        
        if user1.score == 0:
            print(f"You ran out of guesses. The number was {number}.")

            user1.addList()
            
            break
    
        if number > guess:
            print("\nYour guess was too low.")
            user1.score -= 100
            
        elif number < guess:
            print("\nYour guess was too high.")
            user1.score -= 100

        else:
            print(f"\nYou got it! Your score was {user1.score}.")

            user1.addList()
            
            break

        

# Ask user if they want to run the program again
def again():

    global endGame

    leave = input("\nWould you like to run the program again? Y / N: ").strip().upper()

    if leave.upper() == "N":

        
        endGame = True

    else:

        print("\n Running it back.")


# Reads any existing leaderboard and formats it into the lbInfo list
def loadLeaderboard():

    f = open("leaderboard.txt", "r")

    for line in f:

        oldScore = line.strip().split(": ")

        if len(oldScore) == 2:

            name, score = oldScore
            lbInfo.append((name, int(score)))

    f.close()

    order() 



# Function for putting the leaderboard in highest to lowest order
def order():

    # key=lambda allows you to sort based on the value at index 1 of the tuple

    lbInfo.sort(key=lambda x: x[1], reverse=True)

      
# Function for writing scores to leaderboard.txt
def writeScore():

    f = open("leaderboard.txt", "w")

    for name, score in lbInfo:

        f.write(f"\n{name}: {score}")


    f.close()
    

# Main menu function
def title():

    print(" _________________________________________________")
    print("|         Welcome to Guess the Number 2.0         |")
    print("|_________________________________________________|")


    go = input("\nPress any key to continue.")


# Now we call the functions in order. title() and loadLeaderboard() only need to be run at the beginning

title()

loadLeaderboard()

# Loop to keep the game going until the player stops it
while True:

    game()

    order()

    writeScore()

    again()

    if endGame == True:

        print("\nGoodbye!")
        break



    
    
